<!DOCTYPE html>
<html lang="en">
<head>
    <title>anilist-tools</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.3/core.css" />
    <script type="module" src="https://pyscript.net/releases/2024.1.3/core.js"></script>
    <!-- As required by https://github.com/koenvo/pyodide-http#enabling-cross-origin-isolation,
    enable Cross Origin Isolation on GitHub Pages, via a tweak of the file suggested in
    https://github.com/community/community/discussions/13309#discussioncomment-3844940, using require-corp instead. -->
    <script src="enable-threads.js"></script>
    <py-config type="toml">
        packages = ['pyodide-http', 'requests']
        terminal = true

        [[fetch]]
        files = ['./compare_seasons.py', './compare_staff.py', './upcoming_sequels.py', './utils.py', './staff_types.py']
    </py-config>
</head>
<body>
    <div>An assortment of tools using the AniList API.</div>

    <br>
    <div>Enter your AniList username</div>
    <input type="text" id="anilist-username"/>

    <br>
    <div>Enter years and/or seasons of anime to compare your list scores from (e.g. "2022" or "Winter 2021"). Requires username.</div>
    <input type="text" id="season1"/>
    <input type="text" id="season2"/>
    <button py-click="_compare_seasons">Compare years/seasons</button>

    <br>
    <div>Compare the staff from two shows to find those that worked on both (username not required).</div>
    <input type="text" id="show1"/>
    <input type="text" id="show2"/>
    <button py-click="_compare_staff">Compare staff</button>

    <br>
    <div>Find shows from the just-started or upcoming seasons for which an earlier season is in your completed/planning list (slow; ~5 min).</div>
    <button py-click="_upcoming_sequels">Get upcoming sequels</button>

    <br>
    <br>
    <button py-click="clear_terminal">Clear terminal</button>

    <br>
    <br>
    <script type="py" terminal>
        from js import document as _DOC
        from pyscript import display

        # requests lib patch via pyodide per https://github.com/pyscript/pyscript/issues/91#issuecomment-1370958654 and
        # https://github.com/koenvo/pyodide-http#usage
        import pyodide_http
        pyodide_http.patch_all()
        import requests

        import time
        import urllib3
        urllib3.disable_warnings()  # Per https://urllib3.readthedocs.io/en/latest/advanced-usage.html#tls-warnings

        import compare_seasons
        import compare_staff
        import upcoming_sequels

        async def _compare_seasons(event):
            username = _DOC.getElementById('anilist-username').value
            seasons = [ _DOC.getElementById(input_id).value for input_id in ('season1', 'season2')
                       if _DOC.getElementById(input_id).value]
            await compare_seasons.main([username] + seasons)

        async def _compare_staff(event):
            shows = [ _DOC.getElementById(input_id).value for input_id in ('show1', 'show2')
                     if _DOC.getElementById(input_id).value]
            await compare_staff.main(shows)

        async def _upcoming_sequels(event):
            username = _DOC.getElementById('anilist-username').value
            await upcoming_sequels.main([username])

        def clear_terminal(event):
            for row in _DOC.querySelectorAll("py-terminal .xterm-rows > div"):
                row.innerHTML = ''
    </script>
</body>
</html>
