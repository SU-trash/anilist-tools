<!DOCTYPE html>
<html lang="en">
<head>
    <title>anilist-tools</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.3/core.css" />
    <script type="module" src="https://pyscript.net/releases/2024.1.3/core.js"></script>
    <!-- As required by https://github.com/koenvo/pyodide-http#enabling-cross-origin-isolation,
    enable Cross Origin Isolation on GitHub Pages, via a tweak of the file suggested in
    https://github.com/community/community/discussions/13309#discussioncomment-3844940, using require-corp instead. -->
    <!-- <script src="enable-threads.js"></script> -->
    <!-- pyodide-http doesn't seem to work via <py-env>, need <py-config> -->
    <!-- TODO: Can probably change back to whatever py-env was now that we don't need pyodide-http? -->
    <py-config type="toml">
        packages = ['requests']
        terminal = true

        [[fetch]]
        files = ['./compare_seasons.py', './compare_staff.py', './upcoming_sequels.py', './utils.py', './staff_types.py']
    </py-config>
</head>
<body>
    <script type="py">
        from js import document as _DOC

        import requests

        import compare_seasons
        import compare_staff
        import upcoming_sequels

        async def _compare_seasons():
            username = Element('anilist-username').element.value
            seasons = [Element(input_id).element.value for input_id in ('season1', 'season2')
                       if Element(input_id).element.value]
            await compare_seasons.main([username] + seasons)

        async def _compare_staff():
            shows = [Element(input_id).element.value for input_id in ('show1', 'show2')
                     if Element(input_id).element.value]
            await compare_staff.main(shows)

        async def _upcoming_sequels():
            username = Element('anilist-username').element.value
            await upcoming_sequels.main([username])

        def clear_terminal():
            _DOC.getElementsByClassName("py-terminal")[0].innerHTML = ''
    </script>

    <div>An assortment of tools using the AniList API.</div>

    <br>
    <div>Enter your AniList username</div>
    <input type="text" id="anilist-username"/>

    <br>
    <div>Enter years and/or seasons of anime to compare your list scores from (e.g. "2022" or "Winter 2021"). Requires username.</div>
    <input type="text" id="season1"/>
    <input type="text" id="season2"/>
    <button id="compare-seasons-button" type="submit" py-click="_compare_seasons()">Compare years/seasons</button>

    <br>
    <div>Compare the staff from two shows to find those that worked on both (username not required).</div>
    <input type="text" id="show1"/>
    <input type="text" id="show2"/>
    <button id="compare-staff-button" type="submit" py-click="_compare_staff()">Compare staff</button>

    <br>
    <div>Find shows from the just-started or upcoming seasons for which an earlier season is in your completed/planning list (slow; ~5 min).</div>
    <button id="upcoming-sequels-button" type="submit" py-click="_upcoming_sequels()">Get upcoming sequels</button>

    <br>
    <br>
    <button id="clear-terminal-button" type="submit" py-click="clear_terminal()">Clear terminal</button>
</body>
</html>
